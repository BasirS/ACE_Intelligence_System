import"./hoisted.C6e_9ZjQ.js";import"./DataVisualizationLayout.astro_astro_type_script_index_0_lang.BZ9RW9NV.js";class A{constructor(t){this.container=t,this.data=[],this.config={highlightStudentHours:!0,showWeekdays:!0,showWeekends:!0},this.init()}async init(){await this.loadData(),this.render(),this.attachEventListeners()}async loadData(){try{const n=await(await fetch("/data/insights/hourly_agg.csv")).text();this.data=this.parseCSV(n),console.log("Temporal data loaded:",this.data.length,"records")}catch(t){console.error("Failed to load temporal data:",t)}}parseCSV(t){const n=t.trim().split(`
`),r=n[0].split(",").map(i=>i.trim());return n.slice(1).map(i=>{const c=i.split(",").map(e=>e.trim()),s=r.reduce((e,o,g)=>(e[o]=c[g],e),{});return{weekday:s.weekday||"",hour:parseInt(s.hour)||0,violations:parseInt(s.violations)||0}}).filter(Boolean)}render(){if(this.data.length===0)return;const t={top:50,right:80,bottom:60,left:120},n=this.container.clientWidth-t.left-t.right,r=400-t.top-t.bottom;this.container.innerHTML="";const i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("width",(n+t.left+t.right).toString()),i.setAttribute("height",(r+t.top+t.bottom).toString()),i.setAttribute("role","img"),i.setAttribute("aria-label","Heatmap showing violation patterns by hour and day");const c=document.createElementNS("http://www.w3.org/2000/svg","g");c.setAttribute("transform",`translate(${t.left},${t.top})`),i.appendChild(c);const s=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],e=Array.from({length:24},(a,l)=>l),o=a=>a*n/24,g=a=>a*r/7,y=n/24,f=r/7,b=Math.max(...this.data.map(a=>a.violations)),v=a=>`rgba(37, 99, 235, ${a/b})`;s.forEach((a,l)=>{e.forEach(h=>{const p=this.data.find(w=>w.weekday===a&&w.hour===h)?.violations||0,d=document.createElementNS("http://www.w3.org/2000/svg","rect");d.setAttribute("x",o(h).toString()),d.setAttribute("y",g(l).toString()),d.setAttribute("width",y.toString()),d.setAttribute("height",f.toString()),d.setAttribute("fill",v(p)),d.setAttribute("stroke","#fff"),d.setAttribute("stroke-width","1"),this.config.highlightStudentHours&&[7,8,9,10].includes(h)&&(d.setAttribute("stroke","#fbbf24"),d.setAttribute("stroke-width","3"));const m=document.createElementNS("http://www.w3.org/2000/svg","title");m.textContent=`${a} ${h}:00 - ${p} violations`,d.appendChild(m),c.appendChild(d)})}),this.addAxes(c,s,e,n,r),this.container.appendChild(i)}addAxes(t,n,r,i,c){n.forEach((s,e)=>{const o=document.createElementNS("http://www.w3.org/2000/svg","text");o.setAttribute("x","-10"),o.setAttribute("y",(e*c/7+c/14).toString()),o.setAttribute("text-anchor","end"),o.setAttribute("dominant-baseline","central"),o.setAttribute("fill","var(--color-text-primary)"),o.textContent=s.slice(0,3),t.appendChild(o)}),r.filter((s,e)=>e%4===0).forEach(s=>{const e=document.createElementNS("http://www.w3.org/2000/svg","text");e.setAttribute("x",(s*i/24+i/48).toString()),e.setAttribute("y",(c+20).toString()),e.setAttribute("text-anchor","middle"),e.setAttribute("fill","var(--color-text-primary)"),e.textContent=`${s}:00`,t.appendChild(e)})}attachEventListeners(){document.getElementById("highlight-student-hours")?.addEventListener("change",r=>{this.config.highlightStudentHours=r.target.checked,this.render()}),document.querySelectorAll('.day-filter input[type="checkbox"]').forEach(r=>{r.addEventListener("change",()=>{this.updateDayFilters()})})}updateDayFilters(){const t=document.querySelector('.day-filter input[value="weekdays"]')?.checked,n=document.querySelector('.day-filter input[value="weekends"]')?.checked;this.config.showWeekdays=t,this.config.showWeekends=n,this.render()}}document.addEventListener("DOMContentLoaded",()=>{const u=document.getElementById("temporal-heatmap");u&&new A(u)});
