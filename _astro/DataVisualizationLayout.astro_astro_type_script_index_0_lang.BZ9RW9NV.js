document.addEventListener("DOMContentLoaded",()=>{c()});function c(){document.querySelectorAll(".sticky-nav").forEach(n=>{new IntersectionObserver(([a])=>{n.classList.toggle("is-stuck",!a.isIntersecting)},{threshold:1}).observe(n.previousElementSibling||n)}),document.querySelectorAll(".viz-layout-split").forEach(n=>{const t=n.querySelector(".sidebar-content");t&&l(t)}),document.querySelectorAll(".data-visualization-section").forEach(n=>{const t=n.querySelector(".visualization-content");t&&(n.addEventListener("viz-loading",()=>{t.classList.add("loading")}),n.addEventListener("viz-loaded",()=>{t.classList.remove("loading")}),n.addEventListener("viz-error",a=>{t.classList.remove("loading"),t.classList.add("error"),t.innerHTML=`
            <div>
              <h3>Visualization Error</h3>
              <p>${a.detail?.message||"Unable to load data visualization"}</p>
              <button onclick="location.reload()">Retry</button>
            </div>
          `}))}),r(),d()}function l(e){if(window.innerWidth<=1024){const i=document.createElement("button");i.className="sidebar-toggle",i.innerHTML="ðŸ“Š Analysis Details",i.setAttribute("aria-expanded","false"),i.setAttribute("aria-controls",e.id||"sidebar"),e.parentNode?.insertBefore(i,e),e.classList.add("mobile-hidden"),i.addEventListener("click",()=>{const o=i.getAttribute("aria-expanded")==="true";i.setAttribute("aria-expanded",(!o).toString()),e.classList.toggle("mobile-hidden"),i.textContent=o?"ðŸ“Š Analysis Details":"âœ• Close Details"})}}function r(){const e=document.querySelector(".main-content");e&&!e.id&&(e.id="main-content"),document.querySelectorAll(".data-visualization-section").forEach((o,n)=>{const t=document.createElement("a");t.href="#main-content",t.className="skip-to-content",t.textContent="Skip to visualization",o.insertBefore(t,o.firstChild)})}function d(){document.querySelectorAll(".sidebar-content").forEach(o=>{o.addEventListener("keydown",n=>{if(n.key==="Escape"){const t=o.parentNode?.querySelector(".sidebar-toggle");t&&o.classList.contains("mobile-hidden")===!1&&(t.click(),t.focus())}})}),document.querySelectorAll(".sticky-nav").forEach(o=>{o.querySelectorAll('a, button, input, select, textarea, [tabindex]:not([tabindex="-1"])').forEach(t=>{t.addEventListener("focus",()=>{t.scrollIntoView({behavior:"smooth",block:"nearest"})})})})}function s(e,i,o){const n=new CustomEvent(i,{detail:o});e.dispatchEvent(n)}window.VisualizationLayout={emitLoading:e=>s(e,"viz-loading"),emitLoaded:e=>s(e,"viz-loaded"),emitError:(e,i)=>s(e,"viz-error",{message:i})};
