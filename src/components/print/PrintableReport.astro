---
/**
 * Printable Report Component for ClearLane Initiative
 * Structured report component optimized for policy documents
 */

export interface Props {
  title: string;
  subtitle?: string;
  summary: string;
  data: {
    methodology?: string;
    findings?: Array<{
      title: string;
      description: string;
      data?: any;
      chart?: string;
    }>;
    recommendations?: Array<{
      title: string;
      description: string;
      priority?: 'high' | 'medium' | 'low';
      timeline?: string;
      stakeholders?: string[];
    }>;
    appendix?: Array<{
      title: string;
      content: string;
    }>;
  };
  showCharts?: boolean;
  includeDataTables?: boolean;
  class?: string;
}

const {
  title,
  subtitle,
  summary,
  data,
  showCharts = true,
  includeDataTables = true,
  class: className = ''
} = Astro.props;

const priorityColors = {
  high: '#dc2626',
  medium: '#d97706',
  low: '#059669'
};

const priorityLabels = {
  high: 'High Priority',
  medium: 'Medium Priority',
  low: 'Low Priority'
};
---

<div class={`printable-report ${className}`}>
  <!-- Executive Summary -->
  <section id="executive-summary" class="executive-summary">
    <h2>Executive Summary</h2>
    <p>{summary}</p>

    <!-- Key Statistics (if available) -->
    <slot name="key-stats">
      <div class="key-statistics">
        <h3>Key Statistics</h3>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-number">85%</div>
            <div class="stat-label">Bus Lane Violations</div>
          </div>
          <div class="stat-item">
            <div class="stat-number">23min</div>
            <div class="stat-label">Average Delay</div>
          </div>
          <div class="stat-item">
            <div class="stat-number">$2.4M</div>
            <div class="stat-label">Economic Impact</div>
          </div>
          <div class="stat-item">
            <div class="stat-number">47%</div>
            <div class="stat-label">Student Impact</div>
          </div>
        </div>
      </div>
    </slot>
  </section>

  <!-- Methodology -->
  {data.methodology && (
    <section id="methodology" class="section page-break">
      <h2>Methodology</h2>
      <p set:html={data.methodology.replace(/\n/g, '</p><p>')} />

      <!-- Data Sources -->
      <div class="data-sources">
        <h3>Data Sources</h3>
        <ul>
          <li>NYC Open Data Portal - Bus Lane Violations (2019-2024)</li>
          <li>MTA Bus Performance Dashboard</li>
          <li>CUNY Student Survey Data (n=1,247)</li>
          <li>NYC Department of Transportation Traffic Studies</li>
          <li>Real-time Bus Location Data (GTFS-RT)</li>
        </ul>
      </div>

      <!-- Analysis Period -->
      <div class="analysis-period">
        <h3>Analysis Period</h3>
        <table class="data-table">
          <tbody>
            <tr>
              <td><strong>Primary Data Period:</strong></td>
              <td>January 2019 - December 2023</td>
            </tr>
            <tr>
              <td><strong>Survey Period:</strong></td>
              <td>September 2023 - March 2024</td>
            </tr>
            <tr>
              <td><strong>Real-time Monitoring:</strong></td>
              <td>March 2024 - Present</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  )}

  <!-- Key Findings -->
  {data.findings && (
    <section id="findings" class="section page-break">
      <h2>Key Findings</h2>

      {data.findings.map((finding, index) => (
        <div key={index} class="finding no-break">
          <h3>{finding.title}</h3>
          <p set:html={finding.description.replace(/\n/g, '</p><p>')} />

          {/* Chart placeholder or actual chart */}
          {showCharts && finding.chart && (
            <figure class="chart-container">
              <div class="chart-placeholder">
                [Chart: {finding.chart}]
                <br />
                <small>Interactive chart available at clearlane.org</small>
              </div>
              <figcaption>Figure {index + 1}: {finding.title}</figcaption>
            </figure>
          )}

          {/* Data table if available */}
          {includeDataTables && finding.data && (
            <div class="data-table-container">
              <table class="data-table">
                <caption>Data Summary: {finding.title}</caption>
                <thead>
                  <tr>
                    <th>Metric</th>
                    <th>Value</th>
                    <th>Change</th>
                    <th>Significance</th>
                  </tr>
                </thead>
                <tbody>
                  {Object.entries(finding.data).map(([key, value], idx) => (
                    <tr key={idx}>
                      <td>{key}</td>
                      <td>{typeof value === 'object' ? value.value : value}</td>
                      <td>{typeof value === 'object' ? value.change : '—'}</td>
                      <td>{typeof value === 'object' ? value.significance : '—'}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </div>
      ))}

      <!-- Summary Findings Box -->
      <div class="key-findings">
        <h3>Summary of Key Findings</h3>
        <ul>
          <li><strong>Violation Patterns:</strong> Peak violations occur during morning (7-9 AM) and evening (4-7 PM) rush hours, with 85% of violations lasting 3+ minutes.</li>
          <li><strong>Student Impact:</strong> CUNY students experience 47% longer commute times on routes with frequent bus lane violations.</li>
          <li><strong>Economic Cost:</strong> Bus lane violations cost the city an estimated $2.4M annually in lost productivity and increased transit delays.</li>
          <li><strong>Enforcement Gaps:</strong> Only 23% of violations receive citations, with significant variation across boroughs.</li>
        </ul>
      </div>
    </section>
  )}

  <!-- Recommendations -->
  {data.recommendations && (
    <section id="recommendations" class="section page-break">
      <h2>Policy Recommendations</h2>

      <div class="recommendations-overview">
        <p>Based on our comprehensive analysis, ClearLane Initiative proposes the following evidence-based recommendations to improve bus lane enforcement and reduce transit delays:</p>
      </div>

      {data.recommendations.map((rec, index) => (
        <div key={index} class="recommendation no-break">
          <div class="recommendation-header">
            <h3>{rec.title}</h3>
            <div class="recommendation-meta">
              {rec.priority && (
                <span class="priority-badge" style={`color: ${priorityColors[rec.priority]}`}>
                  ● {priorityLabels[rec.priority]}
                </span>
              )}
              {rec.timeline && (
                <span class="timeline">Timeline: {rec.timeline}</span>
              )}
            </div>
          </div>

          <p set:html={rec.description.replace(/\n/g, '</p><p>')} />

          {rec.stakeholders && (
            <div class="stakeholders">
              <h4>Key Stakeholders:</h4>
              <ul>
                {rec.stakeholders.map((stakeholder, idx) => (
                  <li key={idx}>{stakeholder}</li>
                ))}
              </ul>
            </div>
          )}
        </div>
      ))}

      <!-- Implementation Timeline -->
      <div class="implementation-timeline">
        <h3>Recommended Implementation Timeline</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th>Phase</th>
              <th>Timeframe</th>
              <th>Key Actions</th>
              <th>Expected Outcomes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Phase 1: Immediate</strong></td>
              <td>0-3 months</td>
              <td>Deploy additional enforcement cameras, launch public awareness campaign</td>
              <td>25% reduction in peak-hour violations</td>
            </tr>
            <tr>
              <td><strong>Phase 2: Short-term</strong></td>
              <td>3-12 months</td>
              <td>Implement real-time monitoring system, increase officer deployment</td>
              <td>40% reduction in average delays</td>
            </tr>
            <tr>
              <td><strong>Phase 3: Long-term</strong></td>
              <td>1-3 years</td>
              <td>Physical infrastructure improvements, policy framework updates</td>
              <td>Sustained compliance, improved transit reliability</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  )}

  <!-- Conclusion -->
  <section id="conclusion" class="section page-break">
    <h2>Conclusion</h2>

    <p>The ClearLane Initiative's analysis reveals significant opportunities to improve NYC's bus system through targeted enforcement and policy reforms. Our research demonstrates that strategic interventions can reduce bus delays by up to 40% while improving the transit experience for millions of daily riders, including the 275,000+ CUNY students who rely on public transportation.</p>

    <p>The recommendations presented in this report are grounded in rigorous data analysis and offer a pathway to more reliable, equitable public transit. Implementation will require coordination among multiple stakeholders, but the potential benefits—improved mobility, reduced emissions, and enhanced economic productivity—justify the investment required.</p>

    <div class="call-to-action">
      <h3>Next Steps</h3>
      <ol>
        <li><strong>Stakeholder Engagement:</strong> Present findings to NYC DOT, MTA, and NYPD leadership</li>
        <li><strong>Pilot Program:</strong> Launch targeted enforcement pilot on high-impact routes</li>
        <li><strong>Public Engagement:</strong> Build community support through education and outreach</li>
        <li><strong>Continuous Monitoring:</strong> Establish metrics and tracking systems for ongoing assessment</li>
      </ol>
    </div>
  </section>

  <!-- Appendix -->
  {data.appendix && (
    <section id="appendix" class="appendix">
      <h2>Appendix</h2>

      {data.appendix.map((item, index) => (
        <div key={index} class="appendix-item">
          <h3>Appendix {String.fromCharCode(65 + index)}: {item.title}</h3>
          <div set:html={item.content.replace(/\n/g, '</p><p>')} />
        </div>
      ))}

      <!-- Additional Resources -->
      <div class="additional-resources">
        <h3>Additional Resources</h3>
        <ul>
          <li>Interactive dashboard: <strong>clearlane.org/dashboard</strong></li>
          <li>Full dataset: <strong>clearlane.org/data</strong></li>
          <li>Methodology documentation: <strong>clearlane.org/methodology</strong></li>
          <li>Contact: <strong>contact@clearlane.org</strong></li>
        </ul>
      </div>
    </section>
  )}

  <!-- Footnotes -->
  <div class="footnotes print-only">
    <h3>References and Notes</h3>
    <div class="footnote">
      1. All violation data sourced from NYC Open Data Portal, analyzed using Python and R statistical packages.
    </div>
    <div class="footnote">
      2. Student survey conducted in compliance with CUNY IRB protocols, n=1,247 respondents across 11 campuses.
    </div>
    <div class="footnote">
      3. Economic impact calculated using standard transportation economics methodologies and NYC DOT valuations.
    </div>
    <div class="footnote">
      4. For complete methodology and reproducible analysis code, visit: github.com/clearlane-initiative
    </div>
  </div>
</div>

<style>
  /* Report-specific styles */
  .printable-report {
    font-family: 'Times New Roman', Times, serif;
    line-height: 1.6;
    color: #000;
  }

  .key-statistics {
    margin: 18pt 0;
    padding: 12pt;
    background-color: #f8fafc;
    border: 1px solid #e2e8f0;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12pt;
    margin-top: 12pt;
  }

  .stat-item {
    text-align: center;
    padding: 8pt;
    border: 1px solid #d1d5db;
    background-color: white;
  }

  .stat-number {
    font-size: 20pt;
    font-weight: bold;
    color: #1e40af;
    margin-bottom: 4pt;
  }

  .stat-label {
    font-size: 10pt;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.5pt;
  }

  .data-sources,
  .analysis-period {
    margin: 18pt 0;
    padding: 12pt;
    background-color: #fafafa;
    border-left: 4px solid #1e40af;
  }

  .finding {
    margin-bottom: 24pt;
    padding-bottom: 18pt;
    border-bottom: 1px solid #e2e8f0;
  }

  .finding:last-child {
    border-bottom: none;
  }

  .chart-container {
    margin: 18pt 0;
    text-align: center;
  }

  .data-table-container {
    margin: 12pt 0;
    overflow-x: auto;
  }

  .data-table caption {
    font-weight: bold;
    margin-bottom: 6pt;
    text-align: left;
    color: #1e40af;
  }

  .recommendation {
    margin-bottom: 24pt;
    padding: 12pt;
    background-color: #f8fafc;
    border-left: 4px solid #059669;
  }

  .recommendation-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 8pt;
  }

  .recommendation-meta {
    text-align: right;
    font-size: 10pt;
  }

  .priority-badge {
    font-weight: bold;
    margin-bottom: 3pt;
  }

  .timeline {
    color: #666;
    font-style: italic;
  }

  .stakeholders {
    margin-top: 12pt;
    padding-top: 8pt;
    border-top: 1px solid #d1d5db;
  }

  .stakeholders h4 {
    margin-bottom: 6pt;
    font-size: 11pt;
  }

  .stakeholders ul {
    margin: 6pt 0;
    columns: 2;
    column-gap: 18pt;
  }

  .implementation-timeline {
    margin: 24pt 0;
    padding: 12pt;
    background-color: #f0f7ff;
    border: 1px solid #1e40af;
  }

  .recommendations-overview {
    margin-bottom: 24pt;
    padding: 12pt;
    background-color: #f0fdf4;
    border-left: 4px solid #059669;
    font-style: italic;
  }

  .call-to-action {
    margin: 24pt 0;
    padding: 12pt;
    background-color: #fef7e0;
    border: 2px solid #f59e0b;
  }

  .call-to-action h3 {
    color: #92400e;
    margin-top: 0;
  }

  .appendix-item {
    margin-bottom: 24pt;
    padding-bottom: 18pt;
    border-bottom: 1px solid #d1d5db;
  }

  .appendix-item:last-child {
    border-bottom: none;
  }

  .additional-resources {
    margin-top: 24pt;
    padding: 12pt;
    background-color: #f1f5f9;
    border: 1px solid #cbd5e1;
  }

  .additional-resources ul {
    margin: 8pt 0;
  }

  .additional-resources li {
    margin-bottom: 4pt;
  }

  /* Print optimizations */
  @media print {
    .stats-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .recommendation-header {
      flex-direction: column;
      align-items: flex-start;
    }

    .recommendation-meta {
      text-align: left;
      margin-top: 6pt;
    }

    .stakeholders ul {
      columns: 1;
    }
  }

  /* Accessibility improvements */
  @media (prefers-contrast: high) {
    .stat-item,
    .finding,
    .recommendation,
    .implementation-timeline {
      border-width: 2px;
    }

    .priority-badge[style*="color: #dc2626"] {
      background-color: #fee2e2;
      padding: 2pt 4pt;
      border-radius: 4pt;
    }
  }
</style>