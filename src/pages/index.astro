---
/**
 * Home Page - ClearLane Initiative
 * Personal story hook with progressive narrative disclosure
 * Force rebuild: 2025-01-25
 */

import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/shared/Header.astro';
import Hero from '../components/sections/Hero.astro';
import Card from '../components/ui/Card.astro';
import Button from '../components/ui/Button.astro';
import TemporalChart from '../components/charts/TemporalChart.astro';
import RouteAnalyzer from '../components/interactive/RouteAnalyzer.astro';
import DataVisualizationLayout from '../components/layout/DataVisualizationLayout.astro';

// Hero stats from your research
const heroStats = [
  {
    value: '270,000+',
    label: 'Students',
    description: 'Depend on NYC buses daily'
  },
  {
    value: '2 Hours',
    label: 'BxM10 Commute',
    description: 'My rolling study hall'
  },
  {
    value: '83%',
    label: 'Violations',
    description: 'Concentrated at 90 locations'
  }
];

// Key findings from your research - FACT-PROVEN DATA FROM EXECUTIVE PRESENTATION
const keyFindings = [
  {
    title: 'System Failure Confirmed',
    description: 'Analysis of 557 enforced routes reveals 85.6% system failure rate. Despite 3.78 million violation records, enforcement is broken.',
    icon: 'üìç',
    stat: '85.6%',
    statLabel: 'system failure rate proven'
  },
  {
    title: 'Exempt Vehicle Crisis',
    description: '870,810 exempt violations (23.0% of total) with 46.9% repeat offenders. Top offender: 1,377 violations over 658 days.',
    icon: '‚è∞',
    stat: '23.0%',
    statLabel: 'violations are exempt abuse'
  },
  {
    title: 'Q44+ Case Study',
    description: 'Q44+ route accumulated 164,806 violations yet experienced -3.3% speed decrease. System costs 7,067,750 annual student hours.',
    icon: '‚úÖ',
    stat: '7M+',
    statLabel: 'student hours lost annually'
  }
];

// Solution components
const solutionComponents = [
  {
    title: 'Data-Driven Targeting',
    description: 'Focus enforcement on the 90 hotspots that cause 90% of student disruptions.',
    icon: 'üéØ'
  },
  {
    title: 'Student Commute Priority',
    description: 'Deploy resources during 7-10 AM weekdays when students need reliable transit most.',
    icon: 'üìö'
  },
  {
    title: 'Measurable Results',
    description: 'Track success with speed improvements and violation reduction metrics.',
    icon: 'üìä'
  }
];

const pageTitle = 'My Bus is My Study Hall - ClearLane Initiative';
const pageDescription = 'How a student transformed a 2-hour BxM10 commute into a rolling study hall, and why targeted bus enforcement is crucial for educational equity.';
---

<BaseLayout
  title={pageTitle}
  description={pageDescription}
  keywords="rolling study hall, BxM10, student commute, bus enforcement, educational equity"
>
  <Header currentPath="/" />

  <main id="main-content">
    <!-- Hero Section: Personal Story Hook -->
    <Hero
      title="My Bus is My Study Hall"
      subtitle="ClearLane Initiative"
      description="How I transformed my 2-hour BxM10 commute into the most productive part of my day, and why bus enforcement failures threaten this vital study time."
      ctaText="Analyze Your Route"
      ctaHref="#route-analyzer"
      secondaryCtaText="See the Data"
      secondaryCtaHref="#findings"
      variant="personal"
      stats={heroStats}
    >
      <div slot="visual" class="space-y-6">
        <!-- Personal Story Visualization -->
        <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 border border-white/20">
          <h3 class="text-xl font-semibold text-white mb-4">The Rolling Study Hall</h3>
          <div class="space-y-4">
            <div class="flex items-center text-white/90">
              <div class="w-2 h-2 bg-green-400 rounded-full mr-3 flex-shrink-0"></div>
              <span class="text-sm">6:30 AM - Board BxM10 in the Bronx</span>
            </div>
            <div class="flex items-center text-white/90">
              <div class="w-2 h-2 bg-blue-400 rounded-full mr-3 flex-shrink-0"></div>
              <span class="text-sm">6:35 AM - Open textbook, start studying</span>
            </div>
            <div class="flex items-center text-white/90">
              <div class="w-2 h-2 bg-yellow-400 rounded-full mr-3 flex-shrink-0"></div>
              <span class="text-sm">7:15 AM - Complete 2 homework assignments</span>
            </div>
            <div class="flex items-center text-white/90">
              <div class="w-2 h-2 bg-red-400 rounded-full mr-3 flex-shrink-0"></div>
              <span class="text-sm">8:30 AM - Arrive at Baruch, ready for class</span>
            </div>
          </div>

          <div class="mt-6 p-4 bg-black/30 rounded-lg border border-white/20">
            <p class="text-sm text-white font-medium italic">
              "When buses run on time, I can complete up to 10 hours of studying per week during my commute.
              But delays don't just make me late, they steal my study hall."
            </p>
          </div>
        </div>
      </div>
    </Hero>

    <!-- Problem Definition Section -->
    <section class="py-16 bg-white dark:bg-gray-900">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
          <h2 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-white mb-6">
            Buses Are Educational Infrastructure
          </h2>
          <p class="text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto">
            For working students who can't afford alternatives, reliable transit isn't a convenience,
            it's the foundation of academic success. Current enforcement systems fail to protect this vital study time.
          </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-16">
          {keyFindings.map((finding, index) => (
            <Card
              variant="elevated"
              hover={true}
              className="text-center group"
              key={finding.title}
            >
              <div class="text-4xl mb-4 emoji-container" role="img" aria-label={`${finding.title} icon`}>
          {finding.title === 'Peak Violation Hours' ? 'üöå' : 
           finding.title === 'Campus Impact' ? 'üè´' : 
           finding.title === 'Enforcement Paradox' ? '‚öñÔ∏è' : 
           finding.title === 'Predictive Insights' ? 'üìä' : finding.icon}
        </div>
              <div class="text-3xl font-bold text-primary mb-2">{finding.stat}</div>
              <div class="text-sm text-gray-500 uppercase tracking-wide mb-4">{finding.statLabel}</div>
              <h3 class="text-xl font-semibold text-gray-900 mb-3">{finding.title}</h3>
              <p class="text-gray-600">{finding.description}</p>
            </Card>
          ))}
        </div>

        <div class="text-center">
          <Button href="/ACE_Intelligence_System/methodology" variant="outline" size="lg">
            <span role="img" aria-label="Chart icon">üìä</span> See Our Research Methodology
          </Button>
        </div>
      </div>
    </section>

    <!-- Data Investigation Section -->
    <section id="findings" class="py-16 bg-gray-50 dark:bg-gray-800 print-break-before">
      <DataVisualizationLayout
        title="What the Data Reveals"
        description="Our analysis of 3.78 million violation records shows clear patterns that can guide targeted enforcement."
        layout="story"
      >
        <!-- Temporal Analysis -->
        <div class="mb-12">
          <h3 class="text-2xl font-bold text-gray-900 mb-6">
            When Student Commutes Are Most Disrupted
          </h3>
          <p class="text-lg text-gray-600 mb-8">
            Violations peak during morning student commute hours, directly threatening the "rolling study hall" time
            that working students depend on for academic success.
          </p>
          <TemporalChart highlightStudentHours={true} />
        </div>

        <!-- Geographic Concentration -->
        <div class="mb-12">
          <h3 class="text-2xl font-bold text-gray-900 mb-6">
            Where Student Commutes Are Most Vulnerable
          </h3>
          <p class="text-lg text-gray-600 mb-8">
            Bus violations are concentrated at specific locations near college campuses.
            This geographic clustering makes targeted enforcement both feasible and effective.
          </p>
          <div class="w-full rounded-lg overflow-hidden border border-gray-200">
            <iframe
              src="/ACE_Intelligence_System/plots/enhanced_spatial_intelligence_map.html"
              title="Enhanced Spatial Intelligence Map"
              class="w-full h-[32rem] bg-white"
              loading="lazy"
            ></iframe>
          </div>
        </div>

        <!-- Call to Action -->
        <div class="text-center bg-primary/5 rounded-2xl p-8 border border-primary/10">
          <h3 class="text-2xl font-bold text-gray-900 mb-4">
            Ready to Dive Deeper?
          </h3>
          <p class="text-lg text-gray-600 mb-6">
            Explore our complete analysis, including campus proximity studies,
            enforcement paradox calculations, and the full ClearLane solution framework.
          </p>
          <div class="flex flex-col sm:flex-row gap-4 justify-center">
            <Button href="/ACE_Intelligence_System/findings" variant="outline" size="lg">
              üìà View Complete Analysis
            </Button>
            <Button href="/ACE_Intelligence_System/solution" variant="outline" size="lg">
              üí° See Our Solution
            </Button>
          </div>
        </div>
      </DataVisualizationLayout>
    </section>

    <!-- Personal Route Analyzer -->
    <section id="route-analyzer" class="py-16 bg-white dark:bg-gray-900">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
          <h2 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-white mb-6">
            How Do Violations Affect Your Commute?
          </h2>
          <p class="text-xl text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
            Enter your bus route and travel times to see how enforcement failures impact your daily journey
            and study time. Your data helps strengthen the case for ClearLane.
          </p>
        </div>

        <RouteAnalyzer />
      </div>
    </section>

    <!-- Dashboard Teaser -->
    <section class="py-16 bg-gray-50 dark:bg-gray-800">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-6">
          Explore Live Dashboards
        </h2>
        <p class="text-lg text-gray-600 dark:text-gray-300 mb-8">
          Dive deeper into the data with Albert's interactive Streamlit dashboards. 
          See real-time analysis of violations, bus speeds, and campus impacts.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <Button href="/ACE_Intelligence_System/dashboard" variant="outline" size="lg">
            üìä View Dashboards
          </Button>
          <Button href="https://jujutsuquery-mta-analytics.streamlit.app/" variant="outline" size="lg">
            üöÄ Open Streamlit
          </Button>
        </div>
      </div>
    </section>



    <!-- Datathon Questions Section -->
    <section class="py-16 bg-primary-600 text-white">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h2 class="text-3xl sm:text-4xl font-bold mb-8">
          The Three Questions Driving ClearLane
        </h2>
        <p class="text-xl text-primary-200 mb-12 max-w-2xl mx-auto">
          As part of the 2025 MTA Datathon, we address critical questions about transit equity and enforcement effectiveness.
        </p>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 border border-white/20">
            <div class="text-2xl font-bold text-yellow-300 mb-4">Question 1</div>
            <h3 class="text-xl font-semibold mb-4">When do violations most impact students?</h3>
            <p class="text-primary-light text-sm">
              Peak violations occur during 7-10 AM weekdays, directly disrupting the "rolling study hall" time that working students depend on.
            </p>
          </div>

          <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 border border-white/20">
            <div class="text-2xl font-bold text-yellow-300 mb-4">Question 2</div>
            <h3 class="text-xl font-semibold mb-4">Where should enforcement be prioritized?</h3>
            <p class="text-primary-light text-sm">
              90% of student-impacting violations occur at just 90 bus stops across NYC, making targeted enforcement both feasible and effective.
            </p>
          </div>

          <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 border border-white/20">
            <div class="text-2xl font-bold text-yellow-300 mb-4">Question 3</div>
            <h3 class="text-xl font-semibold mb-4">What ROI can targeted enforcement achieve?</h3>
            <p class="text-primary-light text-sm">
              ClearLane projects $15 million annual savings, 12% speed improvement and 7,067,750 student hours saved through data-driven enforcement.
            </p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Three Datathon Questions -->
  <section class="py-16 bg-gray-50 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-8 text-center">
        Three Key Datathon Questions
      </h2>
      <div class="space-y-6">
        <ul class="space-y-8">
          <li class="bg-white dark:bg-gray-900 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-3">
              1. Students & Bus Speeds
            </h3>
            <p class="text-gray-800 dark:text-gray-200 mb-3">
              How do bus lane violations specifically impact student commute times and their ability to use travel time for studying ("rolling study halls")?
            </p>
            <div class="bg-blue-50 border-l-4 border-blue-500 p-3 mt-3">
              <p class="text-blue-900 font-medium text-sm">
                <strong>Solution:</strong> Student-serving routes show -3.2% average speed decline despite 890,228 violations, with 621,101 occurring during class hours (8 AM - 5 PM).
              </p>
            </div>
          </li>

          <li class="bg-white dark:bg-gray-900 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-3">
              2. Exempt Vehicle Repeat Offenders
            </h3>
            <p class="text-gray-800 dark:text-gray-200 mb-3">
              Which exempt vehicles (buses, emergency vehicles, etc.) are chronic violators of bus lanes, and what patterns emerge from their repeat offenses?
            </p>
            <div class="bg-red-50 border-l-4 border-red-500 p-3 mt-3">
              <p class="text-red-900 font-medium text-sm">
                <strong>Solution:</strong> 46.9% of 154,123 exempt vehicles are repeat offenders, with #1 offender accumulating 1,377 violations across BX36/BX35 routes over 658 days.
              </p>
            </div>
          </li>

          <li class="bg-white dark:bg-gray-900 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-3">
              3. Congestion Pricing & Violations
            </h3>
            <p class="text-gray-800 dark:text-gray-200 mb-3">
              How has the implementation of congestion pricing affected bus lane violation patterns, and what does this tell us about enforcement effectiveness?
            </p>
            <div class="bg-yellow-50 border-l-4 border-yellow-500 p-3 mt-3">
              <p class="text-yellow-900 font-medium text-sm">
                <strong>Solution:</strong> CBD routes showed +15.8% violation increase post-congestion pricing with -1.3% speed decline, indicating enforcement challenges during policy transition.
              </p>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-900 dark:bg-gray-950 text-white py-12 print:bg-white print:text-black print:border-t-2 print:border-black">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div class="md:col-span-2">
          <div class="flex items-center space-x-3 mb-4">
            <div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center">
              <svg viewBox="0 0 24 24" class="w-5 h-5 text-white" fill="currentColor">
                <path d="M12 2L2 7L12 12L22 7L12 2Z" />
                <path d="M2 17L12 22L22 17" />
                <path d="M2 12L12 17L22 12" />
              </svg>
            </div>
            <div>
              <div class="text-lg font-bold">ClearLane Initiative</div>
              <div class="text-sm text-gray-400">Student-led transit advocacy</div>
            </div>
          </div>
          <p class="text-gray-400 mb-4">
            Using data science to protect the "rolling study halls" that working students depend on for academic success.
          </p>
          <div class="text-sm text-gray-500">
            Part of the 2025 MTA Datathon by Team Jujutsu Query
          </div>
        </div>

        <div>
          <h3 class="font-semibold mb-4">Research</h3>
          <ul class="space-y-2 text-sm text-gray-400">
            <li><a href="/ACE_Intelligence_System/methodology" class="hover:text-white transition-colors">Methodology</a></li>
            <li><a href="/ACE_Intelligence_System/findings" class="hover:text-white transition-colors">Key Findings</a></li>
            <li><a href="/ACE_Intelligence_System/solution" class="hover:text-white transition-colors">Solution Framework</a></li>
            <li><a href="#route-analyzer" class="hover:text-white transition-colors">Route Analyzer</a></li>
          </ul>
        </div>

        <div>
          <h3 class="font-semibold mb-4">Take Action</h3>
          <ul class="space-y-2 text-sm text-gray-400">
            <li><a href="/contact" class="hover:text-white transition-colors">Contact Officials</a></li>
            <li><a href="/ACE_Intelligence_System/about" class="hover:text-white transition-colors">About the Team</a></li>
            <li><a href="/contact#share-story" class="hover:text-white transition-colors">Share Your Story</a></li>
          </ul>
        </div>
      </div>

      <div class="border-t border-gray-800 mt-8 pt-8 text-sm text-gray-400 text-center">
        <p class="mb-2"><strong>Jujutsu Query team:</strong> Basir A. Samad @ Baruch, Albert Bagdasarov @ Hunter, Caitline Reyes @ Hunter, Tenzin Namdol @ Baruch</p>
        <p>&copy; 2025 ClearLane Initiative. Data-driven advocacy for educational equity.</p>
      </div>
    </div>
  </footer>
</BaseLayout>

<script>
  // Enhanced analytics and user engagement
  document.addEventListener('DOMContentLoaded', () => {
    // Track section visibility for engagement metrics
    const sections = document.querySelectorAll('section[id]');
    const sectionObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const sectionName = entry.target.id || 'hero';

          // Analytics tracking
          if (typeof gtag !== 'undefined') {
            gtag('event', 'section_view', {
              section_name: sectionName,
              page_title: document.title
            });
          }
        }
      });
    }, { threshold: 0.3 });

    sections.forEach(section => sectionObserver.observe(section));

    // Track scroll depth for engagement
    let maxScrollDepth = 0;
    const trackScrollDepth = () => {
      const scrollDepth = Math.round(
        (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100
      );

      if (scrollDepth > maxScrollDepth) {
        maxScrollDepth = scrollDepth;

        // Track milestone scroll depths
        if ([25, 50, 75, 90].includes(maxScrollDepth)) {
          if (typeof gtag !== 'undefined') {
            gtag('event', 'scroll_depth', {
              scroll_depth: maxScrollDepth,
              page_title: document.title
            });
          }
        }
      }
    };

    let scrollTimeout;
    window.addEventListener('scroll', () => {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(trackScrollDepth, 100);
    }, { passive: true });

    // Enhanced route analyzer interaction tracking
    const routeAnalyzer = document.getElementById('route-analyzer');
    if (routeAnalyzer) {
      const analyzeButton = routeAnalyzer.querySelector('button[type="submit"]');
      if (analyzeButton) {
        analyzeButton.addEventListener('click', () => {
          if (typeof gtag !== 'undefined') {
            gtag('event', 'route_analysis_started', {
              page_title: document.title,
              section: 'homepage'
            });
          }
        });
      }
    }

    // Performance monitoring
    window.addEventListener('load', () => {
      if ('performance' in window) {
        const loadTime = performance.now();
        const navigation = performance.getEntriesByType('navigation')[0];

        if (typeof gtag !== 'undefined') {
          gtag('event', 'page_performance', {
            load_time: Math.round(loadTime),
            dom_content_loaded: navigation?.domContentLoadedEventEnd || 0,
            page_title: document.title
          });
        }
      }
    });
  });
</script>